<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="Musium.Controls.TrackItemControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Musium.Controls"
    xmlns:converters="using:Musium.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">
    <UserControl.Resources>
        <converters:GetLosslessGlyph x:Key="GetLosslessGlyph" />
        <converters:GetFavoritedGlyph x:Key="GetFavoritedGlyph" />
        <converters:DurationConverter x:Key="DurationConverter" />
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter" />
        <converters:BoolGridLengthConverter x:Key="BoolGridLengthConverter" />
    </UserControl.Resources>

    <Button Background="Transparent"
        BorderThickness="0"
        Padding="6,6,16,6"
        HorizontalAlignment="Stretch"
        HorizontalContentAlignment="Stretch"
        Click="Button_Click">
        <Button.ContextFlyout>
            <MenuFlyout>
                <MenuFlyoutItem Text="Play next" Click="NextQueue_Click">
                    <MenuFlyoutItem.Icon>
                        <SymbolIcon Symbol="Import"/>
                    </MenuFlyoutItem.Icon>
                </MenuFlyoutItem>
                <MenuFlyoutItem Text="Add to Queue" Click="LastQueue_Click">
                    <MenuFlyoutItem.Icon>
                        <FontIcon Glyph="&#xEA52;"/>
                    </MenuFlyoutItem.Icon>
                </MenuFlyoutItem>
                <MenuFlyoutItem Text="Favorite" Click="Favorite_Click">
                    <MenuFlyoutItem.Icon>
                        <FontIcon Glyph="{x:Bind Song.Favorited, Mode=OneWay, Converter={StaticResource GetFavoritedGlyph}}"/>
                    </MenuFlyoutItem.Icon>
                </MenuFlyoutItem>
            </MenuFlyout>
        </Button.ContextFlyout>
        <Grid VerticalAlignment="Center" HorizontalAlignment="Stretch" ColumnSpacing="32">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="{x:Bind TrackView, Converter={StaticResource BoolGridLengthConverter}, Mode=OneWay}"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="30"/>
                <ColumnDefinition Width="45"/>
                <ColumnDefinition Width="40"/>
            </Grid.ColumnDefinitions>

            <Grid Grid.Column="0" CornerRadius="4" Height="48" Width="48" Margin="0,0,-16,0" >
                <Image Source="{x:Bind DisplayedCoverArt, Mode=OneWay, TargetNullValue='/Assets/Placeholder.png'}" Visibility="{x:Bind TrackView, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                <TextBlock Text="{x:Bind Song.TrackNumber, Mode=OneWay, TargetNullValue=''}" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="SemiLight" Visibility="{x:Bind TrackView, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
            </Grid>

            <StackPanel Grid.Column="1" HorizontalAlignment="Stretch" VerticalAlignment="Center">
                <TextBlock Text="{x:Bind Song.Title, Mode=OneWay, TargetNullValue='Title'}" FontSize="16" HorizontalAlignment="Left" VerticalAlignment="Center" TextTrimming="WordEllipsis"/>
                <TextBlock Text="{x:Bind Song.Album.Artist.Name, Mode=OneWay, TargetNullValue='Artist'}" HorizontalAlignment="Left" VerticalAlignment="Center" TextTrimming="WordEllipsis" Visibility="{x:Bind TrackView, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            </StackPanel>

            <TextBlock Grid.Column="2" Text="{x:Bind Song.Album.Title, Mode=OneWay, TargetNullValue='Album'}" VerticalAlignment="Center" HorizontalAlignment="Left" TextTrimming="WordEllipsis" Visibility="{x:Bind TrackView, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            <TextBlock Grid.Column="3" Text="{x:Bind Song.Genre, Mode=OneWay, TargetNullValue=''}" VerticalAlignment="Center" HorizontalAlignment="Left" TextTrimming="WordEllipsis" Visibility="{x:Bind TrackView, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            
            <FontIcon Grid.Column="4" Glyph="{x:Bind Song.Lossless, Mode=OneWay, Converter={StaticResource GetLosslessGlyph}}" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="5"/>
            <Button Grid.Column="5" Background="Transparent" CornerRadius="50" VerticalAlignment="Center" HorizontalAlignment="Right" Width="45" Height="45" Click="Favorite_Click">
                <FontIcon Glyph="{x:Bind Song.Favorited, Mode=OneWay, Converter={StaticResource GetFavoritedGlyph}}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
            </Button>
            <TextBlock Grid.Column="6" Text="{x:Bind Song.Duration, Mode=OneWay, Converter={StaticResource DurationConverter}}" VerticalAlignment="Center" HorizontalAlignment="Right" TextTrimming="WordEllipsis"/>
        </Grid>
    </Button>
</UserControl>
